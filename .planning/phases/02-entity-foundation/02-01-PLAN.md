---
phase: 02-entity-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/schema/organization.ts
  - lib/schema/types.ts
  - components/json-ld.tsx
  - app/[locale]/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Organization schema appears in HTML source of every page"
    - "Schema has correct inLanguage value matching page locale"
    - "Schema includes consistent NAP data (name, email, sameAs)"
    - "Organization schema references Person via founder @id"
  artifacts:
    - path: "lib/schema/organization.ts"
      provides: "Organization schema generator with bilingual support"
      exports: ["generateOrganizationSchema"]
    - path: "lib/schema/types.ts"
      provides: "Shared constants for schema URLs and configuration"
      exports: ["BASE_URL", "ORGANIZATION_ID", "PERSON_ID"]
    - path: "components/json-ld.tsx"
      provides: "Reusable JSON-LD injection component with XSS protection"
      exports: ["JsonLd"]
    - path: "app/[locale]/layout.tsx"
      provides: "Layout with Organization schema injection"
  key_links:
    - from: "app/[locale]/layout.tsx"
      to: "lib/schema/organization.ts"
      via: "import generateOrganizationSchema"
      pattern: "import.*generateOrganizationSchema.*from.*lib/schema/organization"
    - from: "app/[locale]/layout.tsx"
      to: "components/json-ld.tsx"
      via: "JsonLd component usage"
      pattern: "<JsonLd.*data=.*organizationSchema"
---

<objective>
Implement Organization schema as site-wide JSON-LD for AI knowledge graph entity identity.

Purpose: Establish consistent business entity identity across all pages for AI search engines (ChatGPT, Perplexity, Google AI) to recognize and cite as an authoritative source.
Output: Organization JSON-LD appearing in HTML source of every page with locale-aware content.
</objective>

<execution_context>
@/Users/kazuya/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kazuya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-entity-foundation/02-RESEARCH.md

# Relevant source files
@app/[locale]/layout.tsx
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install schema-dts and create schema infrastructure</name>
  <files>
    package.json
    lib/schema/types.ts
    components/json-ld.tsx
  </files>
  <action>
1. Install schema-dts as dev dependency:
   ```bash
   npm install --save-dev schema-dts
   ```

2. Create `lib/schema/types.ts` with shared constants:
   - BASE_URL: Use `process.env.NEXT_PUBLIC_SITE_URL` or fallback to 'https://kazuya.work'
   - ORGANIZATION_ID: `${BASE_URL}/#organization`
   - PERSON_ID: `${BASE_URL}/#person`
   - Locale type: `'en' | 'ja'`

3. Create `components/json-ld.tsx` with XSS-safe JSON-LD injection:
   - Accept `data: object` prop
   - Render `<script type="application/ld+json">` with dangerouslySetInnerHTML
   - Apply XSS protection: `JSON.stringify(data).replace(/</g, '\\u003c')`
   - Export as named export `JsonLd`

Note: This is a shared component for all schema types (Organization, Person, Article, etc.).
  </action>
  <verify>
    - `npm list schema-dts` shows installed version
    - `npx tsc --noEmit` passes (no type errors)
    - `lib/schema/types.ts` exists with BASE_URL, ORGANIZATION_ID, PERSON_ID exports
    - `components/json-ld.tsx` exists with JsonLd export
  </verify>
  <done>
    Schema infrastructure is ready: schema-dts installed, shared types defined, JsonLd component available for use.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Organization schema generator</name>
  <files>
    lib/schema/organization.ts
  </files>
  <action>
Create `lib/schema/organization.ts` following the research pattern:

1. Import types from schema-dts: `Organization`, `WithContext`
2. Import constants from `./types`: BASE_URL, ORGANIZATION_ID, PERSON_ID

3. Define locale-specific data object with:
   - name: 'Kazuya Hibara' (both locales)
   - alternateName: undefined for en, '日原和也' for ja
   - description: English/Japanese versions (from research)
   - email: 'contact@kazuya.work'
   - sameAs: LinkedIn and GitHub URLs (placeholder - use actual profile URLs if known)

4. Export `generateOrganizationSchema(locale: 'en' | 'ja')` returning `WithContext<Organization>`:
   - '@context': 'https://schema.org'
   - '@type': 'Organization'
   - '@id': ORGANIZATION_ID
   - name, alternateName (if ja), url: BASE_URL
   - logo: Use opengraph.png since logo.png doesn't exist (note: may need proper logo later)
   - description: locale-specific
   - email: 'contact@kazuya.work'
   - sameAs: array of profile URLs
   - founder: { '@id': PERSON_ID } (reference, not full object)
   - inLanguage: locale

Note: Logo uses opengraph.png as fallback. Task 02-02 will add Person schema that completes the founder reference.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - File exports generateOrganizationSchema function
    - Function returns valid schema structure for both 'en' and 'ja'
  </verify>
  <done>
    Organization schema generator exists with bilingual support, proper @id references, and locale-aware content.
  </done>
</task>

<task type="auto">
  <name>Task 3: Inject Organization schema into layout</name>
  <files>
    app/[locale]/layout.tsx
  </files>
  <action>
Modify `app/[locale]/layout.tsx` to inject Organization schema:

1. Add imports at top:
   ```typescript
   import { generateOrganizationSchema } from '@/lib/schema/organization'
   import { JsonLd } from '@/components/json-ld'
   ```

2. Inside LocaleLayout function, after `const { locale } = await params`:
   ```typescript
   const organizationSchema = generateOrganizationSchema(locale as 'en' | 'ja')
   ```

3. Add JsonLd component inside `<body>` tag, before `<NextIntlClientProvider>`:
   ```tsx
   <body>
     <JsonLd data={organizationSchema} />
     <NextIntlClientProvider messages={messages}>
       ...
     </NextIntlClientProvider>
   </body>
   ```

The schema will now appear on every page that uses this layout (all locale pages).
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npm run build` completes without errors (ignore pages-manifest warning)
    - Start dev server: View page source at http://localhost:3000/en and http://localhost:3000/ja
    - Verify JSON-LD script tag with Organization schema appears in both locales
    - Verify inLanguage matches the page locale (en vs ja)
  </verify>
  <done>
    Organization schema appears in HTML source of every page with correct locale-specific content.
  </done>
</task>

</tasks>

<verification>
## Phase Verification

Run these checks to confirm Organization schema is properly implemented:

1. **TypeScript compilation:**
   ```bash
   npx tsc --noEmit
   ```
   Should pass with no errors.

2. **HTML source inspection:**
   - Start dev server: `npm run dev`
   - Visit http://localhost:3000/en, View Page Source
   - Search for `application/ld+json`
   - Verify Organization schema with `"@type": "Organization"` appears
   - Verify `"inLanguage": "en"` in English version

3. **Japanese locale:**
   - Visit http://localhost:3000/ja, View Page Source
   - Verify `"inLanguage": "ja"` and `"alternateName": "日原和也"` appear

4. **Rich Results Test (optional but recommended):**
   - If deployed to staging, run through https://search.google.com/test/rich-results
   - Should detect Organization structured data
</verification>

<success_criteria>
1. Organization schema appears in HTML `<head>` or `<body>` of every page
2. Schema has `@type: "Organization"` with valid structure
3. `inLanguage` property matches page locale (en/ja)
4. Schema includes `founder` reference to `#person` (connection point for Plan 02-02)
5. No TypeScript errors, build passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-entity-foundation/02-01-SUMMARY.md`
</output>
